{% extends "base.html" %}

{% block content %}
<article class="plant-detail-container">

    <header style="text-align: center; margin-bottom: 40px;">
        <h1 style="font-size: 3.5rem; margin-bottom: 5px; color: #3e4a3d;">{{ plant.nazwa_pl }}</h1>
        <p style="font-style: italic; color: #5a6b5a; font-size: 1.4rem; font-family: 'Playfair Display', serif;">
            {{ plant.nazwa_lat }} <span style="font-size: 1rem; color: #888;">| Rodzina: {{ plant.rodzina }}</span>
        </p>
        <div style="width: 120px; height: 4px; background: #b8860b; margin: 20px auto;"></div>
        <p style="max-width: 800px; margin: 0 auto; font-size: 1.15rem; line-height: 1.8;">{{ plant.opis }}</p>
    </header>

    <div class="row g-4 mb-5">
        {% if plant.profil_energetyczny %}
        <div class="col-md-6">
            <div class="info-card h-100">
                <h4 class="card-header-custom"><i class="bi bi-fire"></i> Profil Energetyczny</h4>
                <div class="p-3">
                    <ul class="list-unstyled">
                        <li><strong>Smak:</strong> {{ plant.profil_energetyczny.smak }}</li>
                        <li><strong>Termika:</strong> {{ plant.profil_energetyczny.termika }}</li>
                        <li><strong>Wilgotno≈õƒá:</strong> {{ plant.profil_energetyczny.wilgotnosc }}</li>
                        <li><strong>≈ªywio≈Ç:</strong> {{ plant.profil_energetyczny.zywiol }}</li>
                    </ul>
                    <p class="small text-muted mt-2 border-top pt-2"><em>"{{ plant.profil_energetyczny.opis }}"</em></p>
                </div>
            </div>
        </div>
        {% endif %}

        {% if plant.wymagania %}
        <div class="col-md-6">
            <div class="info-card h-100" style="border-color: #5a6b5a;">
                <h4 class="card-header-custom" style="background: #e9f0e8; color: #2d5a27;"><i class="bi bi-flower1"></i> Wymagania Siedliskowe</h4>
                <div class="p-3">

                    <div class="d-flex justify-content-between align-items-start mb-3 border-bottom border-secondary-subtle pb-2">
                        <span style="min-width: 140px; font-weight: bold; color: #2d5a27;">‚òÄÔ∏è Stanowisko:</span>
                        <span style="text-align: right; font-weight: 600; line-height: 1.3;">{{ plant.wymagania.stanowisko }}</span>
                    </div>

                    <div class="d-flex justify-content-between align-items-start mb-3 border-bottom border-secondary-subtle pb-2">
                        <span style="min-width: 100px; font-weight: bold; color: #2d5a27;">üå± Gleba:</span>
                        <span style="text-align: right; font-weight: 600; line-height: 1.3;">{{ plant.wymagania.gleba }}</span>
                    </div>

                    <div class="d-flex justify-content-between align-items-start mb-3 border-bottom border-secondary-subtle pb-2">
                        <span style="min-width: 100px; font-weight: bold; color: #2d5a27;">üíß Woda:</span>
                        <span style="text-align: right; font-weight: 600; line-height: 1.3;">{{ plant.wymagania.woda }}</span>
                    </div>

                    <div class="d-flex justify-content-between align-items-start">
                        <span style="min-width: 160px; font-weight: bold; color: #2d5a27;">‚ùÑÔ∏è Mrozoodporno≈õƒá:</span>
                        <span style="text-align: right; font-weight: 600; line-height: 1.3;">{{ plant.wymagania.mrozoodpornosc }}</span>
                    </div>

                </div>
            </div>
        </div>
        {% endif %}
    </div>

    {% if plant.identyfikacja %}
    <section class="mb-5 p-4" style="background: #fff; border: 1px dashed #3e4a3d;">
        <h3 style="color: #3e4a3d;"><i class="bi bi-search"></i> Jak rozpoznaƒá?</h3>
        <ul style="margin-bottom: 20px;">
            {% for cecha in plant.identyfikacja.cechy_kluczowe %}
                <li>{{ cecha }}</li>
            {% endfor %}
        </ul>

        {% if plant.identyfikacja.mozliwe_pomy≈Çki %}
        <div class="alert alert-warning">
            <strong>‚ö†Ô∏è Mo≈ºliwe pomy≈Çki:</strong>
            <ul class="mb-0 mt-2">
                {% for pomylka in plant.identyfikacja.mozliwe_pomy≈Çki %}
                    <li>
                        <strong>{{ pomylka.nazwa }}:</strong> {{ pomylka.roznica }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </section>
    {% endif %}

    <hr style="margin: 50px 0; border-top: 1px double #d1c7a7;">

    <section class="morphology-section mb-5">
        <h2 style="text-align: center; margin-bottom: 30px;">üåø Surowce Zielarskie</h2>
        <div class="parts-grid">
            {% for klucz, dane in plant.czesci_rosliny.items() %}
            <div class="part-card">
                <span class="part-badge">{{ klucz }}</span>
                <h3 class="mt-2 text-capitalize">{{ dane.nazwa_surowca }}</h3>
                <p class="text-muted small mb-2">{{ dane.opis_botaniczny }}</p>

                <div class="mb-3">
                    <strong>Dzia≈Çanie:</strong><br>
                    {{ dane.wlasciwo≈õci }}
                </div>

                <div class="ingredients-box">
                    <strong>üß™ Sk≈Çadniki aktywne:</strong>
                    <div class="d-flex flex-wrap gap-1 mt-1">
                        {% if dane.skladniki_aktywne is string %}
                            <span class="chem-tag">{{ dane.skladniki_aktywne }}</span>
                        {% else %}
                            {% for skladnik in dane.skladniki_aktywne %}
                                <span class="chem-tag">{{ skladnik }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                {% if dane.ostrzezenia %}
                <div class="mt-2 text-danger small">
                    <strong>‚ö†Ô∏è Uwaga:</strong> {{ dane.ostrzezenia }}
                </div>
                {% endif %}

                <div class="mt-3 pt-2 border-top text-end small text-muted">
                    üïí Zbi√≥r: <strong>{{ dane.czas_zbioru }}</strong>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    {% if plant.zastosowanie %}
    <section class="mb-5">
        <h2 style="text-align: center; margin-bottom: 30px;">üõ†Ô∏è Zastosowanie Praktyczne</h2>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="use-card h-100">
                    <h4 style="color: #8b0000;"><i class="bi bi-bandaid"></i> Medycyna</h4>
                    <p>{{ plant.zastosowanie.medyczne }}</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="use-card h-100">
                    <h4 style="color: #d4a017;"><i class="bi bi-cup-hot"></i> Kuchnia</h4>
                    <p>{{ plant.zastosowanie.kulinarne }}</p>
                </div>
            </div>
            {% if plant.zastosowanie.rzemieslnicze %}
            <div class="col-md-6">
                <div class="use-card h-100">
                    <h4 style="color: #5d4037;"><i class="bi bi-tools"></i> Rzemios≈Ço</h4>
                    <p>{{ plant.zastosowanie.rzemieslnicze }}</p>
                </div>
            </div>
            {% endif %}
            <div class="col-md-6">
                <div class="use-card h-100">
                    <h4 style="color: #2d5a27;"><i class="bi bi-tree"></i> Ogr√≥d</h4>
                    <p>{{ plant.zastosowanie.ogrodowe }}</p>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    {% if plant.interakcje or plant.ostrzezenia %}
    <section class="safety-section p-4 mb-5" style="border-left: 5px solid #c62828; background: #fff5f5; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
        <h3 style="color: #c62828;"><i class="bi bi-exclamation-octagon-fill"></i> Bezpiecze≈Ñstwo i Interakcje</h3>

        {% if plant.interakcje %}
        <div class="mb-3">
            <strong>üíä Interakcje z lekami:</strong>
            <p>{{ plant.interakcje }}</p>
        </div>
        {% endif %}

        {% if plant.ostrzezenia %}
        <div>
            <strong>üö´ Przeciwwskazania og√≥lne:</strong>
            <p>{{ plant.ostrzezenia }}</p>
        </div>
        {% endif %}
    </section>
    {% endif %}

    <div class="row g-5 mb-5">
        <div class="col-lg-6">
            <h3 class="section-title">üìÖ Kalendarz Biodynamiczny</h3>
            <div class="calendar-list">
                {% for zadanie in plant.kalendarz_ogrodnika.zadania %}
                <div class="calendar-item mb-3 p-3 bg-white border">
                    <div class="d-flex justify-content-between align-items-start">
                        <strong>{{ zadanie.czynnosc }}</strong>
                        <span class="badge bg-secondary ms-2">MiesiƒÖc: {{ zadanie.miesiace|join(', ') }}</span>
                    </div>
                    <p class="small mb-2 mt-2">{{ zadanie.opis }}</p>

                    <div class="d-flex flex-wrap gap-2 mt-2">
                        <span class="badge bg-light text-dark border" style="white-space: normal; text-align: left; line-height: 1.4;">
                            üåë {{ zadanie.faza_ksiezyca }}
                        </span>
                        <span class="badge bg-light text-dark border" style="white-space: normal; text-align: left; line-height: 1.4;">
                            ‚òÅÔ∏è {{ zadanie.pogoda }}
                        </span>
                        {% if zadanie.wplyw_ksiezyca %}
                        <span class="badge bg-light text-dark border" style="white-space: normal; text-align: left; line-height: 1.4; background-color: #fdfaf0 !important;">
                            ‚ú® {{ zadanie.wplyw_ksiezyca }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-6">
            <h3 class="section-title">üå≥ Permakultura</h3>
            <div class="bg-white p-4 border h-100">
                <p><strong>Funkcje w ekosystemie:</strong></p>
                <ul>
                    {% for f in plant.permakultura.funkcje %}
                        <li>{{ f }}</li>
                    {% endfor %}
                </ul>

                <p class="mt-4"><strong>Gildia (Dobrzy sƒÖsiedzi):</strong></p>
                <div class="d-flex flex-wrap gap-2">
                    {% for g in plant.permakultura.gildie %}
                        <span class="badge bg-success p-2">
                            {{ g.nazwa if g.nazwa else g }}
                        </span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    {% if plant.ciekawostki %}
    <section class="mb-5 p-4" style="background: #e9f0e8; border-radius: 8px;">
        <h3>üí° Czy wiesz, ≈ºe...</h3>
        <ul>
            {% for c in plant.ciekawostki %}
                <li class="mb-2">{{ c }}</li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}

    <hr style="margin: 50px 0;">

    <section class="comments-section">
        <h3>üìù Notatki i Obserwacje</h3>

        {% if current_user.is_authenticated %}
            <form action="{{ url_for('add_comment', plant_id=plant_id) }}" method="POST" class="mb-4 p-3 bg-white border">
                <textarea name="content" class="form-control mb-2" placeholder="Tw√≥j wpis..." rows="3"></textarea>
                <div class="form-check">
                    <input type="checkbox" name="is_private" id="is_private" class="form-check-input">
                    <label for="is_private" class="form-check-label">Notatka prywatna üîí</label>
                </div>
                <button type="submit" class="btn btn-green mt-2">Dodaj wpis</button>
            </form>
        {% else %}
            <div class="alert alert-light border text-center">
                <a href="{{ url_for('login') }}">Zaloguj siƒô</a>, aby dodawaƒá notatki.
            </div>
        {% endif %}

        <div class="comments-list">
            {% for comment in comments %}
            <div class="card mb-3 {{ 'border-warning' if comment.is_private else '' }}">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <strong>{{ comment.author.username }}</strong>
                        <small class="text-muted">{{ comment.date_posted.strftime('%Y-%m-%d') }}</small>
                    </div>
                    <p class="mt-2 mb-0">{{ comment.content }}</p>
                    {% if comment.is_private %}
                        <span class="badge bg-warning text-dark mt-2">Prywatne</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

</article>

<style>
    .info-card {
        background: #fff;
        border: 1px solid #b8860b;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    .card-header-custom {
        background: #fff8e1;
        color: #b8860b;
        padding: 10px 15px;
        margin: 0;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        font-family: 'Playfair Display', serif;
    }

    .parts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }
    .part-card {
        background: #fff;
        border: 1px solid #d1c7a7;
        padding: 25px;
        position: relative;
        transition: transform 0.2s;
    }
    .part-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
    .part-badge {
        position: absolute; top: -10px; right: 20px;
        background: #3e4a3d; color: white;
        padding: 4px 12px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
    }

    .chem-tag {
        background: #f1f8e9; color: #33691e;
        border: 1px solid #dcedc8;
        padding: 2px 8px; font-size: 0.8rem; border-radius: 10px;
    }

    .use-card {
        background: #fff;
        padding: 20px;
        border-left: 4px solid #ddd;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
    .section-title {
        border-bottom: 2px solid #3e4a3d;
        padding-bottom: 10px;
        margin-bottom: 20px;
        color: #3e4a3d;
    }
</style>
{% endblock %}